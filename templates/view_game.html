
{% extends "base.html" %}

{% block head %}
  {{ super() }}
  <script src="/static/js/jquery.timers.js" type="text/javascript"></script>
  <script src="/static/js/bridge.js" type="text/javascript"></script>
  <script type="text/javascript">
    _bridge = new Bridge('{{input_sgf|safe}}', '{{comment_paths|tojson|safe}}');
  </script>
  <script src="/static/js/honey.js" type="text/javascript"></script>
  <script src="/static/js/ga.js" type="text/javascript"></script>
  <script>
    // Post click handler
    $(function() {
      $("#post_comment form input[value='Post']").click(function(e) {
        $("#post_comment form input[name='short_path_json']").attr("value", JSON.stringify(_bridge.getCurrNodeShortPath()));
        $("#post_comment form input[name='full_path_json']").attr("value", JSON.stringify(_bridge.getCurrNodeFullPath()));
      });
    });
  </script>
{% endblock %}

{% block content %}
  <div class="row">
  <div class="span6">
    <div id='game_info'>
      <span class="red" id='red_player'>red</span> vs. <span class="blue" id='blue_player'>blue</span>
    </div>
    <div id='board'>
      <img alt='' class='boardimage' 
      galleryimg='no' id='boardimage' src='/static/img/board.gif' usemap="#empty_fields" border="0"/>
      <map id="empty_fields" name="empty_fields">
      </map>
    </div>
  </div>

  <div class="span6">
    <div id="post_comment">
      {% if session.username %}
        {% from "macros.html" import render_field %}
        <form method="post" action="{{ url_for('post_comment') }}">
          {{ form.game_id(value=game_id) }}
          {{ form.short_path_json(value=null) }}
          {{ form.full_path_json(value=null) }}
          {{ render_field(form.comment, rows=4, cols=90) }}
          <p><input type=submit value=Post></p>
       </form>
      {% endif %}
    </div>
    <div id="comments">
      {% for comment in comments %}
      <p>
        <div class="comment" id="comment_{{comment._id}}">    
          <div class="label label-info"> Posted by {{ comment.user.username }} on {{ comment.date.strftime("%Y-%m-%d %H:%M:%S")}}:</div>
          {{ comment.text }}
        </div>
      </p>
      {% endfor %}
    </div>
    <div id='help'>
      <h5>Controls:</h5>
      <div><span class="action">click on empty field:</span> <span class="description">play a move</span></div>
      <div><span class="action">left, right:</span> <span class="description">navigate along active branch</span></div>
      <div><span class="action">1-9</span> <span class="description">follow a variant</span></div>
      <div><span class="action">up, down:</span> <span class="description">select from multiple variants</span></div>
      <div><span class="action">x:</span> <span class="description">remove whole subtree</span></div>
    </div>
  </div>
  </div>
{% endblock %}

{% block footer %}
  {{ super()}}
  {% if lg_id %}
    <a href="http://www.littlegolem.net/jsp/game/game.jsp?gid={{lg_id}}">Little Golem</a> |
  {% endif %}
  <a id="download" href="">download sgf</a> |
  <a id="toggle_help" href="">help</a> |
  <a id="contact" href="">contact</a>
  <form id="post_sgf_form" action="/sgf" style="display:none;" method="POST">
    <input id="post_sgf_field" type="hidden" name="sgf" value="">
    <input type="submit" value="go">
  </form>
{% endblock %}
