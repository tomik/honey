{% extends "base.html" %}

{% block head %}
  {{ super() }}
  <script src="/static/js/jquery.timers.js" type="text/javascript"></script>
  <script src="/static/js/bridge.js" type="text/javascript"></script>
  <script type="text/javascript">
    _bridge = new Bridge('{{game.nodes|tojson|safe}}', '{{comment_paths|tojson|safe}}', '{{init_path|tojson|safe}}');
  </script>
  <script src="/static/js/honey.js" type="text/javascript"></script>
  <script src="/static/js/ga.js" type="text/javascript"></script>
  <script>
    // Post click handler
    $(function() {
      $("#post_comment form input[value='Post']").click(function(e) {
        $("#post_comment form input[name='short_path_json']").attr("value", JSON.stringify(_bridge.getCurrNodeShortPath()));
        $("#post_comment form input[name='full_path_json']").attr("value", JSON.stringify(_bridge.getCurrNodeFullPath()));
      });
    });
  </script>
{% endblock %}

{% block content %}
<div class="row" style="margin-top: 20px;">
  <div class="span6">
    <div id='board'>
      <img alt='' class='boardimage' 
      galleryimg='no' id='boardimage' src='/static/img/board.gif' usemap="#empty_fields" border="0"/>
      <map id="empty_fields" name="empty_fields">
      </map>
    </div>
  </div>

  <div class="span6">
    {% include "game_info.html" %}
    <h4 style="margin-bottom: 10px;">Comments</h4>
    {% if session.user %}
    <div id="post_comment">
        {% from "macros.html" import render_field %}
        <form method="post" action="{{ url_for('post_comment') }}">
          {{ form.game_id(value=game._id) }}
          {{ form.short_path_json(value=null) }}
          {{ form.full_path_json(value=null) }}
          {{ render_field(form.comment, label=False, rows=3, cols=90) }}
          <p><input type=submit value=Post></p>
       </form>
    </div>
    {% endif %}
    <div id="comments">
      {% if not comments %}
      <p> No comments yet. </p>
      {% endif %}
      {% for comment in comments %}
      <p>
        <div class="comment" id="comment_{{comment._id}}">
          <div class="label label-info"> Posted by {{ comment.user.username }} on {{ comment.date.strftime("%Y-%m-%d %H:%M:%S")}}:</div>
          {{ comment.text }}
        </div>
      </p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
  <a id="download" href="">download sgf</a> |
  <a id="contact" href="">contact</a>
  <form id="post_sgf_form" action="/sgf" style="display:none;" method="POST">
    <input id="post_sgf_field" type="hidden" name="sgf" value="">
    <input type="submit" value="go">
  </form>
{% endblock %}
